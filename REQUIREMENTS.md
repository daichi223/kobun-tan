# 古文単語学習アプリ 要件定義書

## プロジェクト概要
古文単語と多義語の学習を支援するWebアプリケーション

## 基本機能

### 1. 単語モード
- 単語→意味、意味→単語、例文→意味、意味記述の4種類の出題形式
- 問題数と範囲を指定可能
- 選択式と記述式の両方に対応

### 2. 多義語モード
- 複数の意味を持つ単語の学習
- 例文理解、○×問題、文脈記述の3種類の出題形式
- 問題数と範囲を指定可能

## 採点システム（多義語モード・文脈記述問題）

### 段階的スコアリング
記述解答の採点は以下の段階的スコアで行う:

| スコア | 条件 | 説明 |
|--------|------|------|
| 100% | 完全一致 | 括弧・空白除去後の厳密一致 |
| 95% | 正規化一致 | 旧仮名遣い・表記揺れを吸収した一致 |
| 90% | 形態素一致 | 助詞無視、助動詞集合比較での一致 |
| 85% | 形態素部分一致 | 助動詞の部分集合を許容した一致 |
| 75-80% | 近似一致 | Levenshtein距離による近似マッチ |
| 0% | 不一致 | 上記のいずれにも該当しない |

### 自動遷移と手動判定

#### 自動遷移の条件
- **100%（完全一致）の場合のみ**自動的に次の問題へ遷移
- それ以外のスコアでは自動遷移しない

#### 手動判定（○×ボタン）
- **90%以下のスコア**の場合、正誤を解答者本人が判定
- ○ボタン: 正解として扱い、スコアに加算
- ×ボタン: 不正解として扱い、スコアに加算しない
- 判定後に「次へ」ボタンで次の問題へ遷移

#### 95%の場合
- 自動遷移はしない
- ○×ボタンは表示しない（高精度のため判定不要）
- 「次へ」ボタンのみ表示

### 全問正解による遷移
- すべての意味（sense）が**100%一致**の場合のみ自動遷移
- 1つでも100%未満のものがあれば手動判定が必要

## 文法検証システム

### kobun-grammar.jsonの活用
- 助動詞の左接続規則チェック
- 係り結び（係助詞と結びの形）の呼応チェック
- 曖昧形（「し」「けれ」等）の識別

### 文法エラー表示
- 文法規則違反があればオレンジ色の警告ボックスで表示
- 違反内容、期待値、実際の値、補足説明を提示
- 採点には影響しない（警告のみ）

## 設定の永続化

### localStorage保存項目
以下の設定をlocalStorageに保存し、ページリロード時に復元:

- `kobun-currentMode`: モード選択（単語/多義語）
- `kobun-wordQuizType`: 単語モードのクイズタイプ
- `kobun-wordNumQuestions`: 単語モードの問題数
- `kobun-wordRange`: 単語モードの選択範囲（from/to）
- `kobun-polysemyQuizType`: 多義語モードのクイズタイプ
- `kobun-polysemyNumQuestions`: 多義語モードの問題数
- `kobun-polysemyRange`: 多義語モードの選択範囲（from/to）

## 表記揺れの吸収

### 正規化処理
- NFKC正規化、小文字化
- 括弧・引用符・空白の除去
- 歴史的仮名遣い→現代仮名（ゐ→い、ゑ→え、語中ハ行等）
- 典型パターン（けふ→きょう、さう→そう等）
- 漢字→かな変換（物思→ものおも、我慢→がまん等）

### 形態素解析
- 助詞・助動詞・内容語に分解
- 動詞・形容詞を終止形（辞書形）に正規化
- 連用形語尾（っ、ん、り）の統一処理
- 助動詞の部分集合許容（受身+完了 vs 受身のみ）

## データソース
- `public/kobun500.tsv`: 単語データ
- `public/multiple-meaning-words.tsv`: 多義語データ
- `src/assets/kobun-grammar.json`: 文法規則データ
