# 認証設定ガイド

このアプリケーションは環境変数で3つの認証モードを切り替えられます。

## 認証モード

### モード1: 完全認証あり（ドメイン制限）【デフォルト】
特定ドメインのGoogleアカウントのみアクセス可能

```env
VITE_AUTH_REQUIRED=true
VITE_DOMAIN_CHECK_ENABLED=true  # または省略（デフォルトtrue）
```

**アクセス可能:**
- @st.spec.ed.jp
- @spec.ed.jp

**用途:** 学校専用版


### モード2: 認証あり（ドメイン制限なし）
任意のGoogleアカウントでアクセス可能

```env
VITE_AUTH_REQUIRED=true
VITE_DOMAIN_CHECK_ENABLED=false
```

**アクセス可能:**
- すべてのGoogleアカウント

**用途:** 一般公開版（Googleログイン必須）


### モード3: 認証なし
誰でもアクセス可能（ログイン不要）

```env
VITE_AUTH_REQUIRED=false
```

**アクセス可能:**
- 全員（認証不要）

**用途:** デモ版、開発版


## Vercelでの設定方法

### ドメイン制限なし版を別URLでデプロイ

1. **新しいプロジェクトを作成**
   - Vercel Dashboard → New Project
   - 同じGitリポジトリをインポート
   - プロジェクト名: `kobun-tan-public`

2. **環境変数を設定**
   ```
   VITE_AUTH_REQUIRED=true
   VITE_DOMAIN_CHECK_ENABLED=false
   VITE_FIREBASE_API_KEY=（同じ値）
   VITE_FIREBASE_AUTH_DOMAIN=kotan-25ed1.firebaseapp.com
   VITE_FIREBASE_PROJECT_ID=kotan-25ed1
   VITE_FIREBASE_APP_ID=（同じ値）
   VITE_FIREBASE_STORAGE_BUCKET=kotan-25ed1.appspot.com
   VITE_FIREBASE_MESSAGING_SENDER_ID=（同じ値）
   ```

3. **Deploy**

4. **Firebase Consoleで承認済みドメインを追加**
   - https://console.firebase.google.com/project/kotan-25ed1/authentication/settings
   - 新しいVercel URL（例: `kobun-tan-public.vercel.app`）を追加

### 結果

- `kobun-tan.vercel.app` → ドメイン制限あり（学校専用）
- `kobun-tan-public.vercel.app` → ドメイン制限なし（一般公開）


## ローカル開発での切り替え

### ドメイン制限なしでテスト

`.env.local`を編集：

```env
VITE_AUTH_REQUIRED=true
VITE_DOMAIN_CHECK_ENABLED=false
```

```bash
npm run dev
```

### 認証なしでテスト

```env
VITE_AUTH_REQUIRED=false
```

```bash
npm run dev
```


## トラブルシューティング

### ドメイン制限を無効にしたのに、まだ制限される

- Vercelで環境変数を設定後、**Redeploy**していますか？
- ブラウザのキャッシュをクリアしましたか？

### Firebase認証エラーが出る

- Firebase Consoleの承認済みドメインに、デプロイ先URLが追加されていますか？
- `.env.production`または環境変数に正しいFirebase設定が入っていますか？


## まとめ

| 環境変数 | ドメイン制限あり | ドメイン制限なし | 認証なし |
|----------|------------------|------------------|----------|
| `VITE_AUTH_REQUIRED` | `true` | `true` | `false` |
| `VITE_DOMAIN_CHECK_ENABLED` | `true` | `false` | （不要） |
| **ログイン** | 必要 | 必要 | 不要 |
| **許可ドメイン** | st/spec.ed.jp | すべて | - |
